<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire d'Évaluation Statique avec Dispatcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Styles réutilisés du composant */
        :root {
            --largeur-logo-bouton: 30px; 
            --espacement-button: 10px;   
        }

        /* Conteneur principal */
        .carousel-evaluation {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        /* Section d'évaluation */
        .eval-item {
            padding: 20px 0;
            border-bottom: 1px solid #e5e7eb;
            display: flex; /* Utilisation de flex pour la mise en page interne */
            gap: 20px;
        }

        .eval-item:last-child {
            border-bottom: none;
        }

        /* Contenu de la colonne de gauche (info) */
        .info-col {
            width: 150px;
            flex-shrink: 0;
            text-align: center;
            border-right: 1px solid #e5e7eb;
            padding-right: 20px;
        }

        /* Contenu de la colonne de droite (notation) */
        .rating-col {
            flex-grow: 1;
            padding-left: 20px;
        }
        
        /* Bar de notation */
        .rating-bar {
            display: flex;
            flex-direction: row-reverse; 
            justify-content: flex-end; 
            margin-top: 10px;
        }

        .rating-bar input[type="radio"] {
            display: none;
        }

        .rating-bar label.trmdvsr-radio-label {
            box-sizing: border-box;
            height: var(--largeur-logo-bouton); 
            width: calc( var(--largeur-logo-bouton) + var(--espacement-button) ); 
            background-image: url('https://placehold.co/30x30/d1d5db/white/png?text=★');
            background-repeat: no-repeat;
            background-size: var(--largeur-logo-bouton) var(--largeur-logo-bouton);
            background-position: center left; 
            cursor: pointer;
            transition: transform 0.2s, background-image 0.2s;
        }
        .rating-bar label.trmdvsr-radio-label:nth-last-child(2) {
            width: var(--largeur-logo-bouton);
        }

        /* LOGIQUE VISUELLE DU ROLLOVER (CSS) */
        .rating-bar label.trmdvsr-radio-label:hover,
        .rating-bar label.trmdvsr-radio-label:hover ~ label.trmdvsr-radio-label {
            background-image: url('https://placehold.co/30x30/f59e0b/white/png?text=★');
            transform: scale(1.1);
        }

        /* LOGIQUE VISUELLE DE SÉLECTION (CSS) */
        .rating-bar input[type="radio"]:checked ~ label.trmdvsr-radio-label {
            background-image: url('https://placehold.co/30x30/f59e0b/white/png?text=★');
        }
        .rating-bar input[type="radio"]:checked + label.trmdvsr-radio-label {
            transform: scale(1.1);
        }

        /* Style pour le champ de résultat (géré par JS) */
        .note-result {
            padding: 10px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 700;
            width: 100%;
            text-align: center;
            transition: border-color 0.3s, color 0.3s, background-color 0.3s;
            border: 2px solid;
            margin-top: 10px;
        }
        .border-green-500 { border-color: #10b981; color: #065f46; background-color: #ecfdf5; }
        .border-yellow-500 { border-color: #f59e0b; color: #b45309; background-color: #fffbeb; }
        .border-blue-400 { border-color: #60a5fa; color: #1d4ed8; background-color: #eff6ff; }
        .border-gray-300 { border-color: #d1d5db; color: #4b5563; background-color: #f9fafb; }
        .app-state-display {
            background-color: #eef2ff;
            border: 1px solid #c7d2fe;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            font-family: monospace;
            white-space: pre-wrap;
        }

    </style>
</head>
<body class="bg-gray-50 p-4">

    <form id="evaluationForm" class="carousel-evaluation">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Formulaire d'Évaluation</h1>

        <!-- ÉTAPE 1: Qualité de l'Accueil (q1_accueil) -->
        <section class="eval-item" id="section_q1" data-question-id="q1_accueil">
            <!-- Colonne d'Information (Statique) -->
            <div class="info-col">
                <img class="w-20 h-20 mx-auto rounded-lg mb-2" src="https://placehold.co/80x80/10b981/ffffff?text=Q1" alt="Accueil"/>
                <p class="text-sm text-gray-500">Qualité de l'Accueil</p>
            </div>

            <!-- Colonne de Notation (C'est ici que le JS va attacher le comportement) -->
            <div class="rating-col">
                <h3 class="text-lg font-medium mb-2">Comment évalueriez-vous l'accueil ?</h3>
                
                <!-- Le conteneur de la barre de notation -->
                <div class="rating-bar" id="rating-group-q1">
                    <!-- Les inputs et labels sont déjà là et doivent être pré-câblés -->
                    <!-- Le 'name' doit être unique pour le groupe: eval-q1 -->
                    
                    <input type="radio" name="eval-q1" id="q1-r5" value="5" />
                    <label class="trmdvsr-radio-label" for="q1-r5" data-value="5"></label>
                    
                    <input type="radio" name="eval-q1" id="q1-r4" value="4" />
                    <label class="trmdvsr-radio-label" for="q1-r4" data-value="4"></label>
                    
                    <input type="radio" name="eval-q1" id="q1-r3" value="3" />
                    <label class="trmdvsr-radio-label" for="q1-r3" data-value="3"></label>
                    
                    <input type="radio" name="eval-q1" id="q1-r2" value="2" />
                    <label class="trmdvsr-radio-label" for="q1-r2" data-value="2"></label>
                    
                    <input type="radio" name="eval-q1" id="q1-r1" value="1" />
                    <label class="trmdvsr-radio-label" for="q1-r1" data-value="1"></label>
                    
                    <input type="radio" name="eval-q1" id="q1-r0" value="0" />
                    <label class="trmdvsr-radio-label" for="q1-r0" data-value="0"></label>
                </div>

                <!-- Le champ de résultat qui sera mis à jour -->
                <input type="text" id="result-q1_accueil" value="Non sélectionnée" readonly class="note-result border-yellow-500" />
            </div>
        </section>

        <!-- ÉTAPE 2: Propreté des Locaux (q2_proprete) -->
        <section class="eval-item" id="section_q2" data-question-id="q2_proprete">
            <!-- Colonne d'Information (Statique) -->
            <div class="info-col">
                <img class="w-20 h-20 mx-auto rounded-lg mb-2" src="https://placehold.co/80x80/ef4444/ffffff?text=Q2" alt="Propreté"/>
                <p class="text-sm text-gray-500">Propreté des Locaux</p>
            </div>

            <!-- Colonne de Notation -->
            <div class="rating-col">
                <h3 class="text-lg font-medium mb-2">L'établissement était-il propre ?</h3>
                
                <div class="rating-bar" id="rating-group-q2">
                    <input type="radio" name="eval-q2" id="q2-r5" value="5" />
                    <label class="trmdvsr-radio-label" for="q2-r5" data-value="5"></label>
                    
                    <input type="radio" name="eval-q2" id="q2-r4" value="4" />
                    <label class="trmdvsr-radio-label" for="q2-r4" data-value="4"></label>
                    
                    <input type="radio" name="eval-q2" id="q2-r3" value="3" />
                    <label class="trmdvsr-radio-label" for="q2-r3" data-value="3"></label>
                    
                    <input type="radio" name="eval-q2" id="q2-r2" value="2" />
                    <label class="trmdvsr-radio-label" for="q2-r2" data-value="2"></label>
                    
                    <input type="radio" name="eval-q2" id="q2-r1" value="1" />
                    <label class="trmdvsr-radio-label" for="q2-r1" data-value="1"></label>
                    
                    <input type="radio" name="eval-q2" id="q2-r0" value="0" />
                    <label class="trmdvsr-radio-label" for="q2-r0" data-value="0"></label>
                </div>

                <input type="text" id="result-q2_proprete" value="Non sélectionnée" readonly class="note-result border-yellow-500" />
            </div>
        </section>

        <!-- Ajoutez ici jusqu'à 6 sections avec des IDs uniques (e.g., section_q3, section_q4, etc.) -->

        <button type="submit" class="w-full bg-indigo-600 text-white p-3 rounded-lg mt-8 hover:bg-indigo-700 transition duration-150">
            Passer à l'étape suivante (ou Envoyer)
        </button>

    </form>

    <!-- ZONE DE RÉSULTAT GLOBAL (Écoute l'Event Dispatcher) -->
    <div class="carousel-evaluation mt-8">
        <h2 class="text-xl font-semibold mb-4 text-center">État des Notes Collectées (Global State)</h2>
        <div id="app-state" class="app-state-display">
            Attente de la première note...
        </div>
    </div>

    <script>
        // Mappage des valeurs aux descriptions complètes
        const DESCRIPTIONS = {
            '5': 'Excellent (5/5)',
            '4': 'Très bien (4/5)',
            '3': 'Moyen (3/5)',
            '2': 'Peu satisfaisant (2/5)',
            '1': 'Mauvais (1/5)',
            '0': 'Très Mauvais (0/5)',
        };

        // État global de l'application pour stocker toutes les notes
        let appGlobalState = {}; 

        /**
         * Initialise le comportement interactif (rollover, clic, dispatch)
         * pour une section d'évaluation donnée.
         * @param {HTMLElement} sectionElement - L'élément <section> à initialiser.
         */
        function initializeRatingSection(sectionElement) {
            // 1. Récupération des éléments et IDs existants
            const questionId = sectionElement.dataset.questionId;
            const ratingBar = sectionElement.querySelector('.rating-bar');
            // Le champ de résultat est trouvé par son ID pré-défini
            const resultInput = document.getElementById(`result-${questionId}`); 
            const radioLabels = ratingBar.querySelectorAll('label.trmdvsr-radio-label');

            if (!ratingBar || !resultInput) {
                console.error(`[Init Error] Missing rating bar or result input for ${questionId}`);
                return;
            }

            // Fonction pour mettre à jour l'affichage en fonction de la valeur sélectionnée
            const updateSelectedDisplay = () => {
                const selectedRadio = ratingBar.querySelector(`input[name="eval-${questionId}"]:checked`);
                
                // Réinitialiser les classes
                resultInput.classList.remove('border-green-500', 'border-yellow-500', 'border-blue-400');
                
                if (selectedRadio) {
                    const value = selectedRadio.value;
                    appGlobalState[questionId] = { 
                        note: parseInt(value), 
                        description: DESCRIPTIONS[value],
                        timestamp: new Date().toLocaleTimeString()
                    };
                    resultInput.value = DESCRIPTIONS[value];
                    resultInput.classList.add('border-green-500'); // Vert si sélectionné
                } else {
                    resultInput.value = "Non sélectionnée";
                    resultInput.classList.add('border-yellow-500'); // Jaune si non sélectionné
                }
            };

            // --- Logique du Survol (Rollover pour le texte) ---
            radioLabels.forEach(label => {
                const value = label.dataset.value;

                // MOUSEOVER (Survol) : Afficher le texte de la note survolée
                label.addEventListener('mouseover', () => {
                    resultInput.value = DESCRIPTIONS[value];
                    
                    // Appliquer un style de survol temporaire (Bleu)
                    resultInput.classList.remove('border-green-500', 'border-yellow-500');
                    resultInput.classList.add('border-blue-400'); 
                });

                // MOUSEOUT (Retrait) : Rétablir l'affichage de la note sélectionnée
                label.addEventListener('mouseout', () => {
                    updateSelectedDisplay(); // Rétablir l'affichage permanent
                });
            });

            // --- Logique du Clic (Déclenchement de l'Event Dispatcher) ---
            ratingBar.addEventListener('change', () => {
                updateSelectedDisplay(); // Mise à jour locale et de l'état global

                // 2. Déclenchement de l'événement personnalisé 'ratingSelected'
                const ratingEvent = new CustomEvent('ratingSelected', {
                    detail: appGlobalState[questionId],
                    bubbles: true 
                });

                // Dispatch l'événement à partir de l'élément conteneur
                sectionElement.dispatchEvent(ratingEvent);
            });

            // Initialisation de l'affichage
            updateSelectedDisplay(); 
        }

        // --- GESTIONNAIRE GLOBAL (Écouteur de l'Event Dispatcher) ---

        function handleRatingSelected(event) {
            const { id, note, description } = event.detail;

            // Mise à jour de l'affichage de l'état (pour debug/visualisation)
            const stateDisplay = document.getElementById('app-state');
            stateDisplay.innerHTML = JSON.stringify(appGlobalState, null, 2);

            // Vous pouvez ici implémenter d'autres actions globales
            // Par exemple, vérifier si toutes les notes sont remplies:
            const totalSections = document.querySelectorAll('.eval-item').length;
            const completedNotes = Object.keys(appGlobalState).length;

            if (completedNotes === totalSections) {
                console.log("Toutes les étapes sont complétées ! Prêt à soumettre.");
            }
        }


        // --- Démarrage de l'Application ---
        document.addEventListener('DOMContentLoaded', () => {
            const formElement = document.getElementById('evaluationForm');
            
            // 1. Initialiser tous les composants en parcourant les sections
            const stepElements = formElement.querySelectorAll('.eval-item');
            stepElements.forEach(el => {
                initializeRatingSection(el);
            });

            // 2. Attacher le gestionnaire global au formulaire parent (délégation d'événements)
            formElement.addEventListener('ratingSelected', handleRatingSelected);
            
            // Empêcher la soumission du formulaire pour l'exemple
            formElement.addEventListener('submit', (e) => {
                e.preventDefault();
                console.log("Formulaire soumis ! Données finales:", appGlobalState);
            });
        });
    </script>
</body>
</html>
<div class="rating-bar trmdvsr-sstexte">
                  <label class="trmdvsr-sstexte" for="q1-r5">5</label>
                  <label class="trmdvsr-sstexte" for="q1-r4">4</label>
                  <label class="trmdvsr-sstexte" for="q1-r3">3</label>
                  <label class="trmdvsr-sstexte" for="q1-r2">2</label>
                  <label class="trmdvsr-sstexte" for="q1-r1">1</label>
                  <label class="trmdvsr-sstexte" for="q1-r0">0</label>
                </div>